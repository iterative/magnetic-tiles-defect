schema: '2.0'
stages:
  check_packages:
    cmd: python src/stages/check_pkgs.py --config=params.yaml
    outs:
    - path: pkg_list.txt
      md5: aa965848e4f64414ccd0e8d5505d3a8f
      size: 3437
  data_load:
    cmd: python src/stages/data_load.py --config=params.yaml
    deps:
    - path: pkg_list.txt
      md5: aa965848e4f64414ccd0e8d5505d3a8f
      size: 3437
    - path: src/stages/data_load.py
      md5: 481ef35d6faa72224f0f0842194becbc
      size: 797
    params:
      params.yaml:
        base:
          project: defect_detection
          pkg_list_fname: pkg_list.txt
          pickle_dir: models
          pickle_name: export_learn_obj.pkl
          reports_dir_path: reports
          random_state: 42
        data_load:
          dataset_url: https://github.com/abin24/Magnetic-tile-defect-datasets./archive/refs/heads/master.zip
          data_dir: data
          orig_dirname: Magnetic-tile-defect-datasets.-master
          new_dirname: MAGNETIC_TILE_SURFACE_DEFECTS
          code_names:
          - 0
          - 1
    outs:
    - path: data/MAGNETIC_TILE_SURFACE_DEFECTS/images
      md5: b7178caeac712acf11359c9f183f2cdc.dir
      size: 14666517
      nfiles: 392
    - path: data/MAGNETIC_TILE_SURFACE_DEFECTS/masks
      md5: f92c29262e93249baf066776487c8535.dir
      size: 199417
      nfiles: 392
  data_split:
    cmd: python src/stages/data_split.py --config=params.yaml
    deps:
    - path: data/MAGNETIC_TILE_SURFACE_DEFECTS/images
      md5: b7178caeac712acf11359c9f183f2cdc.dir
      size: 14666517
      nfiles: 392
    - path: data/MAGNETIC_TILE_SURFACE_DEFECTS/masks
      md5: f92c29262e93249baf066776487c8535.dir
      size: 199417
      nfiles: 392
    - path: pkg_list.txt
      md5: aa965848e4f64414ccd0e8d5505d3a8f
      size: 3437
    - path: src/stages/data_split.py
      md5: 34f52be01f05d45585264c1c998765d4
      size: 1295
    params:
      params.yaml:
        base:
          project: defect_detection
          pkg_list_fname: pkg_list.txt
          pickle_dir: models
          pickle_name: export_learn_obj.pkl
          reports_dir_path: reports
          random_state: 42
        data_load:
          dataset_url: https://github.com/abin24/Magnetic-tile-defect-datasets./archive/refs/heads/master.zip
          data_dir: data
          orig_dirname: Magnetic-tile-defect-datasets.-master
          new_dirname: MAGNETIC_TILE_SURFACE_DEFECTS
          code_names:
          - 0
          - 1
        data_split:
          test_pct: 0.25
          train_img_dir_path: data/MAGNETIC_TILE_SURFACE_DEFECTS/train_images
          train_mask_dir_path: data/MAGNETIC_TILE_SURFACE_DEFECTS/train_masks
          test_img_dir_path: data/MAGNETIC_TILE_SURFACE_DEFECTS/test_images
          test_mask_dir_path: data/MAGNETIC_TILE_SURFACE_DEFECTS/test_masks
    outs:
    - path: data/MAGNETIC_TILE_SURFACE_DEFECTS/test_images
      md5: 5d67f1f911a6369537c7cfa14a9183b9.dir
      size: 3655378
      nfiles: 98
    - path: data/MAGNETIC_TILE_SURFACE_DEFECTS/test_masks
      md5: 78fd836bed9f04e3c3140455164cdb12.dir
      size: 48847
      nfiles: 98
    - path: data/MAGNETIC_TILE_SURFACE_DEFECTS/train_images
      md5: eb3d30d58453ab389d75ffaab9a2054b.dir
      size: 11011139
      nfiles: 294
    - path: data/MAGNETIC_TILE_SURFACE_DEFECTS/train_masks
      md5: 543c271ca5fed4bf834ea3fc0af8bb5f.dir
      size: 150570
      nfiles: 294
  train:
    cmd: python src/stages/train.py --config=params.yaml
    deps:
    - path: data/MAGNETIC_TILE_SURFACE_DEFECTS/train_images
      md5: eb3d30d58453ab389d75ffaab9a2054b.dir
      size: 11011139
      nfiles: 294
    - path: data/MAGNETIC_TILE_SURFACE_DEFECTS/train_masks
      md5: 543c271ca5fed4bf834ea3fc0af8bb5f.dir
      size: 150570
      nfiles: 294
    - path: pkg_list.txt
      md5: aa965848e4f64414ccd0e8d5505d3a8f
      size: 3437
    - path: src/stages/train.py
      md5: a6ec2486d381039eac01b2463dfae760
      size: 1597
    params:
      params.yaml:
        base:
          project: defect_detection
          pkg_list_fname: pkg_list.txt
          pickle_dir: models
          pickle_name: export_learn_obj.pkl
          reports_dir_path: reports
          random_state: 42
        data_split:
          test_pct: 0.25
          train_img_dir_path: data/MAGNETIC_TILE_SURFACE_DEFECTS/train_images
          train_mask_dir_path: data/MAGNETIC_TILE_SURFACE_DEFECTS/train_masks
          test_img_dir_path: data/MAGNETIC_TILE_SURFACE_DEFECTS/test_images
          test_mask_dir_path: data/MAGNETIC_TILE_SURFACE_DEFECTS/test_masks
        train:
          img_size: 200
          valid_pct: 0.2
          learning_rate: 0.0003
          batch_size: 16
          n_epochs: 5
          use_cpu: false
          model_pickle_dir_path: models
          model_pickle_fname: model_pickle_fastai.pkl
  evaluate:
    cmd: python src/stages/eval.py --config=params.yaml
    deps:
    - path: data/MAGNETIC_TILE_SURFACE_DEFECTS/test_images
      md5: 5d67f1f911a6369537c7cfa14a9183b9.dir
      size: 3655378
      nfiles: 98
    - path: data/MAGNETIC_TILE_SURFACE_DEFECTS/test_masks
      md5: 78fd836bed9f04e3c3140455164cdb12.dir
      size: 48847
      nfiles: 98
    - path: models/model_pickle_fastai.pkl
      md5: eb4b914aad0c53052b0b73e511ca6e37
      size: 206862325
    - path: pkg_list.txt
      md5: aa965848e4f64414ccd0e8d5505d3a8f
      size: 3437
    - path: src/stages/eval.py
      md5: fb05c96e5d53d99e2e396b14bb99fe8f
      size: 1530
    params:
      params.yaml:
        base:
          project: defect_detection
          pkg_list_fname: pkg_list.txt
          pickle_dir: models
          pickle_name: export_learn_obj.pkl
          reports_dir_path: reports
          random_state: 42
        data_split:
          test_pct: 0.25
          train_img_dir_path: data/MAGNETIC_TILE_SURFACE_DEFECTS/train_images
          train_mask_dir_path: data/MAGNETIC_TILE_SURFACE_DEFECTS/train_masks
          test_img_dir_path: data/MAGNETIC_TILE_SURFACE_DEFECTS/test_images
          test_mask_dir_path: data/MAGNETIC_TILE_SURFACE_DEFECTS/test_masks
        evaluate:
          save_test_preds: false
          metrics_file: metrics.json
        train:
          img_size: 200
          valid_pct: 0.2
          learning_rate: 0.0003
          batch_size: 16
          n_epochs: 5
          use_cpu: false
          model_pickle_dir_path: models
          model_pickle_fname: model_pickle_fastai.pkl
    outs:
    - path: reports/metrics.json
      md5: 4f4b316f31ee8dddda631226512e6e08
      size: 65
